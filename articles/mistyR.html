<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modeling spatially resolved omics with mistyR • mistyR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modeling spatially resolved omics with mistyR">
<meta property="og:description" content="mistyR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119440867-9"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-119440867-9');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mistyR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/mistyR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mistySeurat.html">mistyR and Seurat</a>
    </li>
    <li>
      <a href="../articles/mistySpatialExperiment.html">mistyR and SpatialExperiment/SingleCellExperiment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/saezlab/mistyR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/saezlab" class="external-link">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://www.saezlab.org" class="external-link">
    <span class="fas fa-university"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mistyR_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Modeling spatially resolved omics with mistyR</h1>
                        <h4 data-toc-skip class="author">Jovan Tanevski</h4>
            <address class="author_afil">
      Heidelberg University and Heidelberg University Hospital, Heidelberg, Germany <br>Jožef Stefan Institute, Ljubljana, Slovenia<br><a class="author_email" href="mailto:#"></a><a href="mailto:jovan.tanevski@uni-heidelberg.de" class="email">jovan.tanevski@uni-heidelberg.de</a>
      </address>
                  
            <h4 data-toc-skip class="date">2022-05-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/saezlab/mistyR/blob/HEAD/vignettes/mistyR.Rmd" class="external-link"><code>vignettes/mistyR.Rmd</code></a></small>
      <div class="hidden name"><code>mistyR.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The use of mistyR is conceptualized around building a workflow for analysis of spatial omics data by four classes of functions:</p>
<ul>
<li><p><a href="#view-composition">View composition</a></p></li>
<li><p><a href="#model-training">Model training</a></p></li>
<li><p><a href="#result-processing">Result processing</a></p></li>
<li><p><a href="#plotting">Plotting</a></p></li>
</ul>
<p>To construct a workflow <em><a href="https://github.com/saezlab/mistyR" class="external-link">mistyR</a></em> is designed with the use of pipe operators (for example the operator <code>%&gt;%</code> from <em><a href="https://CRAN.R-project.org/package=magrittr" class="external-link">magrittr</a></em>) for chaining functions in mind.</p>
<p>When loading <em><a href="https://github.com/saezlab/mistyR" class="external-link">mistyR</a></em> please consider configuring a <code><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">future::multisession()</a></code> parallel execution plan. <em><a href="https://github.com/saezlab/mistyR" class="external-link">mistyR</a></em> will then use all available cores for execution of computationally demanding functions. It is recommended that the user modifies the <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code> according to their needs.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># MISTy</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://saezlab.github.io/mistyR/">mistyR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span>

<span class="co"># data manipulation</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fsavje/distances" class="external-link">distances</a></span><span class="op">)</span>

<span class="co"># plotting</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></code></pre></div>
<p>The following example uses the synthetically generated benchmark data <code>synthetic</code> that is included in the package. The dataset is a list of 10 tibbles, each representing data generated from a random layout of four cell types and empty space on a 100-by-100 grid.</p>
<p>The data was generated by simulating a two-dimensional cellular automata model that focuses on signaling events. The model simulates the production, diffusion, degradation and interactions of 11 molecular species. Note that the dataset contains simulated measurements only for the non-empty spaces.</p>
<p><img src="sm.svg" width="300"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"synthetic"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">synthetic</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">col</span>, y <span class="op">=</span> <span class="va">row</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#e9eed3"</span>, <span class="st">"#dcc38d"</span>, <span class="st">"#c9e2ad"</span>, <span class="st">"#a6bab6"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="mistyR_files/figure-html/unnamed-chunk-2-1.png" width="336"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">synthetic</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; spec_tbl_df [4,205 × 14] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;  $ row  : num [1:4205] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ col  : num [1:4205] 100 11 13 14 15 20 23 24 26 32 ...</span>
<span class="co">#&gt;  $ ECM  : num [1:4205] 0.0385 0.0327 0.1444 0.387 0.1635 ...</span>
<span class="co">#&gt;  $ ligA : num [1:4205] 0.834 0.119 0.525 0.269 0.195 ...</span>
<span class="co">#&gt;  $ ligB : num [1:4205] 0.0157 0.0104 0.014 0.0367 0.1176 ...</span>
<span class="co">#&gt;  $ ligC : num [1:4205] 0.236 0.804 0.334 0.502 0.232 ...</span>
<span class="co">#&gt;  $ ligD : num [1:4205] 1.183 0.101 0.434 0.241 0.203 ...</span>
<span class="co">#&gt;  $ protE: num [1:4205] 1.18 0 1.67 0 0 ...</span>
<span class="co">#&gt;  $ protF: num [1:4205] 2.547 0.386 1.614 0.913 0.162 ...</span>
<span class="co">#&gt;  $ prodA: num [1:4205] 0.382 0 0.472 0 0 ...</span>
<span class="co">#&gt;  $ prodB: num [1:4205] 0 0 0 0 0.16 ...</span>
<span class="co">#&gt;  $ prodC: num [1:4205] 0 0.536 0 0.418 0 ...</span>
<span class="co">#&gt;  $ prodD: num [1:4205] 0.588 0 0.379 0 0 ...</span>
<span class="co">#&gt;  $ type : chr [1:4205] "CT1" "CT2" "CT1" "CT2" ...</span></code></pre></div>
<p>For more information about the underlying model and data generation see <code><a href="../reference/synthetic.html">help(synthetic)</a></code> or the <a href="#publication">publication</a>.</p>
</div>
<div class="section level2">
<h2 id="view-composition">View composition<a class="anchor" aria-label="anchor" href="#view-composition"></a>
</h2>
<p>The <em><a href="https://github.com/saezlab/mistyR" class="external-link">mistyR</a></em> workflow always starts by defining an intraview (<code><a href="../reference/create_initial_view.html">create_initial_view()</a></code>) containing measurements of the markers that are the target of the modeling at each cell of interest. For the first sample from the <code>synthetic</code> dataset we select all markers except for the ligands for all available cells.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">expr</span> <span class="op">&lt;-</span> <span class="va">synthetic</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span>, <span class="va">type</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"lig"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">misty.intra</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_initial_view.html">create_initial_view</a></span><span class="op">(</span><span class="va">expr</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">misty.intra</span><span class="op">)</span>
<span class="co">#&gt;                Length Class  Mode     </span>
<span class="co">#&gt; intraview      2      -none- list     </span>
<span class="co">#&gt; misty.uniqueid 1      -none- character</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">misty.intra</span><span class="op">$</span><span class="va">intraview</span><span class="op">)</span>
<span class="co">#&gt;        Length Class       Mode     </span>
<span class="co">#&gt; abbrev 1      -none-      character</span>
<span class="co">#&gt; data   7      spec_tbl_df list</span></code></pre></div>
<p>From the intrinsic view (<em>intraview</em>)<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> <em><a href="https://github.com/saezlab/mistyR" class="external-link">mistyR</a></em> will model the expression of each marker as a function of the expression of other markers within the cell. We are interested in exploring marker expressions coming from different spatial contexts that are complementary, i.e., that are distinguishable and contribute to the explanation of the overall expression of the markers.</p>
<p><em><a href="https://github.com/saezlab/mistyR" class="external-link">mistyR</a></em> includes two default helper functions for calculating and adding views that take into account the spatial context of the data: <code><a href="../reference/add_juxtaview.html">add_juxtaview()</a></code> and <code><a href="../reference/add_paraview.html">add_paraview()</a></code>. The <em>juxtaview</em> represent a local spatial view and captures the expression of all markers available in the intraview within the immediate neighborhood of each cell. The <em>paraview</em> captures the expression of all markers avainalbe in the intraview in the boarder tissue structure where the importance of the influence is proportional to the inverse of the distance between two cells. To add a <em>paraview</em> in the view composition, we first need information about the location of each cell from the intraview. Using this information we can create and add a <em>paraview</em> with importance radius of 10 to the view composition.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pos</span> <span class="op">&lt;-</span> <span class="va">synthetic</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span>

<span class="va">misty.views</span> <span class="op">&lt;-</span> <span class="va">misty.intra</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/add_paraview.html">add_paraview</a></span><span class="op">(</span><span class="va">pos</span>, l <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">misty.views</span><span class="op">)</span>
<span class="co">#&gt;                Length Class  Mode     </span>
<span class="co">#&gt; intraview      2      -none- list     </span>
<span class="co">#&gt; misty.uniqueid 1      -none- character</span>
<span class="co">#&gt; paraview.10    2      -none- list</span></code></pre></div>
<p>The calculation of a <em>juxtaview</em> and a <em>paraview</em> can be computationally intensive when there are a large number of cells in the sample. Therefore the calculation is run in parallel with the set <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code>. The computational time needed for the calculation of the <em>paraview</em> can also be significantly reduced by approximation. Refer to the documentation of this function (<code><a href="../reference/add_paraview.html">help(add_paraview)</a></code>) for more details.</p>
<p>Other relevant and custom views can be created (<code><a href="../reference/create_view.html">create_view()</a></code>) from an external resource (<code>data.frame</code>, <code>tibble</code>) and added to the view composition. The data should contain and one row per cell in order as in the intraview. For example we can create a view that captures the mean expression of the 10 nearest neighbors of each cell.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># find the 10 nearest neighbors</span>
<span class="va">neighbors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/distances/man/nearest_neighbor_search.html" class="external-link">nearest_neighbor_search</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/distances/man/distances.html" class="external-link">distances</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span><span class="op">)</span>, k <span class="op">=</span> <span class="fl">11</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span>

<span class="co"># calculate the mean expression of the nearest neighbors for all markers</span>
<span class="co"># for each cell in expr</span>
<span class="va">nnexpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">expr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="op">~</span> <span class="va">expr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="va">neighbors</span><span class="op">[</span>, <span class="va">.x</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">nn.view</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_view.html">create_view</a></span><span class="op">(</span><span class="st">"nearest"</span>, <span class="va">nnexpr</span>, <span class="st">"nn"</span><span class="op">)</span>

<span class="va">nn.view</span>
<span class="co">#&gt; $nearest</span>
<span class="co">#&gt; $nearest$abbrev</span>
<span class="co">#&gt; [1] "nn"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $nearest$data</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,205 × 7</span></span>
<span class="co">#&gt;      ECM protE protF  prodA  prodB  prodC  prodD</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0.169 0.337 1.07  0.120  0.013<span style="text-decoration: underline;">8</span> 0.146  0.165 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0.346 0.676 0.549 0.096<span style="text-decoration: underline;">9</span> 0.014<span style="text-decoration: underline;">0</span> 0.190  0.076<span style="text-decoration: underline;">6</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0.219 0.304 0.495 0.049<span style="text-decoration: underline;">6</span> 0.028<span style="text-decoration: underline;">8</span> 0.236  0.038<span style="text-decoration: underline;">7</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0.238 0.607 0.651 0.132  0.028<span style="text-decoration: underline;">8</span> 0.095<span style="text-decoration: underline;">4</span> 0.122 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0.313 0.688 0.835 0.166  0.029<span style="text-decoration: underline;">7</span> 0.083<span style="text-decoration: underline;">7</span> 0.173 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0.527 0.743 0.616 0.072<span style="text-decoration: underline;">2</span> 0.018<span style="text-decoration: underline;">4</span> 0.135  0.096<span style="text-decoration: underline;">4</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0.278 0.399 0.501 0.041<span style="text-decoration: underline;">3</span> 0.063<span style="text-decoration: underline;">2</span> 0.160  0.060<span style="text-decoration: underline;">4</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0.266 0.537 0.624 0.073<span style="text-decoration: underline;">8</span> 0.046<span style="text-decoration: underline;">3</span> 0.154  0.117 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0.356 0.564 0.565 0.069<span style="text-decoration: underline;">6</span> 0.041<span style="text-decoration: underline;">5</span> 0.208  0.106 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0.625 0.863 0.458 0.035<span style="text-decoration: underline;">0</span> 0.082<span style="text-decoration: underline;">3</span> 0.230  0.057<span style="text-decoration: underline;">6</span></span>
<span class="co">#&gt; <span style="color: #949494;"># … with 4,195 more rows</span></span></code></pre></div>
<p>The created view(s) can be added (<code><a href="../reference/add_views.html">add_views()</a></code>) to an existing view composition one by one or by providing them in a form of a list. Other examples of creating and adding custom views to the composition can be found in the resources in <a href="#see-also">See also</a>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">extended.views</span> <span class="op">&lt;-</span> <span class="va">misty.views</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/add_views.html">add_views</a></span><span class="op">(</span><span class="va">nn.view</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">extended.views</span><span class="op">)</span>
<span class="co">#&gt;                Length Class  Mode     </span>
<span class="co">#&gt; intraview      2      -none- list     </span>
<span class="co">#&gt; misty.uniqueid 1      -none- character</span>
<span class="co">#&gt; paraview.10    2      -none- list     </span>
<span class="co">#&gt; nearest        2      -none- list</span></code></pre></div>
<p>Views can also be removed from the composition by providing one or more names of views to <code><a href="../reference/remove_views.html">remove_views()</a></code>. The <em>intraview</em> and <em>misty.uniqueid</em> cannot be removed with this function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">extended.views</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/remove_views.html">remove_views</a></span><span class="op">(</span><span class="st">"nearest"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;                Length Class  Mode     </span>
<span class="co">#&gt; intraview      2      -none- list     </span>
<span class="co">#&gt; misty.uniqueid 1      -none- character</span>
<span class="co">#&gt; paraview.10    2      -none- list</span>

<span class="va">extended.views</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/remove_views.html">remove_views</a></span><span class="op">(</span><span class="st">"intraview"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;                Length Class  Mode     </span>
<span class="co">#&gt; intraview      2      -none- list     </span>
<span class="co">#&gt; misty.uniqueid 1      -none- character</span>
<span class="co">#&gt; paraview.10    2      -none- list     </span>
<span class="co">#&gt; nearest        2      -none- list</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-training">Model training<a class="anchor" aria-label="anchor" href="#model-training"></a>
</h2>
<p>Once the view composition is created, the model training is managed by the function <code><a href="../reference/run_misty.html">run_misty()</a></code>. By default, models are trained for each marker available in the <em>intraview</em> for each view independently. The results of the model training will be stored in a folder named “results”.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">misty.views</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/run_misty.html">run_misty</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>
<span class="co">#&gt; [1] "/home/runner/work/mistyR/mistyR/vignettes/results"</span></code></pre></div>
<p>The workflow that we used for the first sample from the <code>synthetic</code> dataset can be easily extended to be applied to all 10 samples to completely reproduce one of the results reported in the <a href="#publication">publication</a>. The results for each sample will be stored in a subfolder of the folder “results”.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result.folders</span> <span class="op">&lt;-</span> <span class="va">synthetic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">imap_chr</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">sample</span>, <span class="va">name</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sample.expr</span> <span class="op">&lt;-</span> <span class="va">sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span>, <span class="va">type</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"lig"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">sample.pos</span> <span class="op">&lt;-</span> <span class="va">sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span>
  
  <span class="fu"><a href="../reference/create_initial_view.html">create_initial_view</a></span><span class="op">(</span><span class="va">sample.expr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/add_paraview.html">add_paraview</a></span><span class="op">(</span><span class="va">sample.pos</span>, l <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="../reference/run_misty.html">run_misty</a></span><span class="op">(</span>results.folder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"results"</span>, <span class="va">.Platform</span><span class="op">$</span><span class="va">file.sep</span>, <span class="va">name</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Generating paraview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Training models</span>

<span class="va">result.folders</span>
<span class="co">#&gt;                                                      synthetic1 </span>
<span class="co">#&gt;  "/home/runner/work/mistyR/mistyR/vignettes/results/synthetic1" </span>
<span class="co">#&gt;                                                     synthetic10 </span>
<span class="co">#&gt; "/home/runner/work/mistyR/mistyR/vignettes/results/synthetic10" </span>
<span class="co">#&gt;                                                      synthetic2 </span>
<span class="co">#&gt;  "/home/runner/work/mistyR/mistyR/vignettes/results/synthetic2" </span>
<span class="co">#&gt;                                                      synthetic3 </span>
<span class="co">#&gt;  "/home/runner/work/mistyR/mistyR/vignettes/results/synthetic3" </span>
<span class="co">#&gt;                                                      synthetic4 </span>
<span class="co">#&gt;  "/home/runner/work/mistyR/mistyR/vignettes/results/synthetic4" </span>
<span class="co">#&gt;                                                      synthetic5 </span>
<span class="co">#&gt;  "/home/runner/work/mistyR/mistyR/vignettes/results/synthetic5" </span>
<span class="co">#&gt;                                                      synthetic6 </span>
<span class="co">#&gt;  "/home/runner/work/mistyR/mistyR/vignettes/results/synthetic6" </span>
<span class="co">#&gt;                                                      synthetic7 </span>
<span class="co">#&gt;  "/home/runner/work/mistyR/mistyR/vignettes/results/synthetic7" </span>
<span class="co">#&gt;                                                      synthetic8 </span>
<span class="co">#&gt;  "/home/runner/work/mistyR/mistyR/vignettes/results/synthetic8" </span>
<span class="co">#&gt;                                                      synthetic9 </span>
<span class="co">#&gt;  "/home/runner/work/mistyR/mistyR/vignettes/results/synthetic9"</span></code></pre></div>
<p>Note that by default, <em><a href="https://github.com/saezlab/mistyR" class="external-link">mistyR</a></em> caches calculated views<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> and trained models, such that in case of repeated running of the workflow they will be retrieved instead of recalculated, thus saving significant computational time. However, the size of the generated cache files can be large. Therefore, the functions that can work with cached files, such as <code><a href="../reference/run_misty.html">run_misty()</a></code>, have parameter named <code>cached</code> that can be set to <code>FALSE</code>. Additionally the function <code><a href="../reference/clear_cache.html">clear_cache()</a></code> provides means to remove cache files.</p>
</div>
<div class="section level2">
<h2 id="result-processing">Result processing<a class="anchor" aria-label="anchor" href="#result-processing"></a>
</h2>
<p>The raw <em><a href="https://github.com/saezlab/mistyR" class="external-link">mistyR</a></em> results are stored in several text files in the output folder for each analyzed sample. The results from one or more samples can be collected, aggregated and coverted to an R object with the function <code><a href="../reference/collect_results.html">collect_results()</a></code>, by providing path(s) to folder(s) containing results generated by <code><a href="../reference/run_misty.html">run_misty()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">misty.results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collect_results.html">collect_results</a></span><span class="op">(</span><span class="va">result.folders</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Collecting improvements</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Collecting contributions</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Collecting importances</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Aggregating</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">misty.results</span><span class="op">)</span>
<span class="co">#&gt;                        Length Class  Mode</span>
<span class="co">#&gt; improvements           4      tbl_df list</span>
<span class="co">#&gt; contributions          4      tbl_df list</span>
<span class="co">#&gt; importances            5      tbl_df list</span>
<span class="co">#&gt; improvements.stats     5      tbl_df list</span>
<span class="co">#&gt; contributions.stats    6      tbl_df list</span>
<span class="co">#&gt; importances.aggregated 5      tbl_df list</span></code></pre></div>
<p>See <code><a href="../reference/collect_results.html">help(collect_results)</a></code> for more information on the structure of <code>misty.results</code>.</p>
</div>
<div class="section level2">
<h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h2>
<p>MISTy gives explanatory answers to three general questions. Each question can be answered by looking at the corresponding plot.</p>
<p><strong>1. How much can the broader spatial context explain the expression of markers (in contrast to the intraview)?</strong></p>
<p>This can be observed in the gain in R2 (absolute percentage) (or relative percentage of decrease RMSE) of using the multiview model in contrast to the single <em>intraview</em> only model.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">misty.results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/plot_improvement_stats.html">plot_improvement_stats</a></span><span class="op">(</span><span class="st">"gain.R2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/plot_improvement_stats.html">plot_improvement_stats</a></span><span class="op">(</span><span class="st">"gain.RMSE"</span><span class="op">)</span></code></pre></div>
<p><img src="mistyR_files/figure-html/unnamed-chunk-11-1.png" width="700"><img src="mistyR_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<p>We can further inspect the significance of the gain in variance explained, by the assigned p-value of improvement based on cross-validation.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">misty.results</span><span class="op">$</span><span class="va">improvements</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">measure</span> <span class="op">==</span> <span class="st">"p.R2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean.p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">mean.p</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 2</span></span>
<span class="co">#&gt;   target mean.p</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ECM    0.018<span style="text-decoration: underline;">4</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> protF  0.049<span style="text-decoration: underline;">6</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> protE  0.421 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> prodA  0.460 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> prodB  0.499 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> prodC  0.503 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> prodD  0.505</span></code></pre></div>
<p>In general, the significant gain in R2 can be interpreted as the following:</p>
<p>“We can better explain the expression of marker X, when we consider additional views, other than the intrinsic view.”</p>
<p><strong>2.How much do different view components contribute to explaining the expression?</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">misty.results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_view_contributions.html">plot_view_contributions</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="mistyR_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>As expected most of the contribution to the prediction of the expression of the markers comes from the <em>intraview</em>. However for the markers that we observed significant improvement of variance we can also observe a proportional estimated contribution of the <em>paraview</em>.</p>
<p><strong>3.What are the specific relations that can explain the contributions?</strong></p>
<p>To explain the contributions, we can visualize the importances of markers coming from each view separately as predictors of the expression of all markers.</p>
<p>First, the <em>intraview</em> importances.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">misty.results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_interaction_heatmap.html">plot_interaction_heatmap</a></span><span class="op">(</span>view <span class="op">=</span> <span class="st">"intra"</span>, cutoff <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p><img src="mistyR_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>These importances are associated to the relationship between markers in the same cell. As we didn’t use the information about the cell types in any way during the process of modeling the significant interactions that we see in the heatmap may come from any of the cell types.</p>
<p>Second, the <em>paraview</em> importances.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">misty.results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_interaction_heatmap.html">plot_interaction_heatmap</a></span><span class="op">(</span>view <span class="op">=</span> <span class="st">"para.10"</span>, cutoff <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="mistyR_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>These importances are associated to the relationship between markers in the cell and markers in the broader structure (controlled by our parameter l).</p>
<p>We can observe that some interactions in the <em>paraview</em> might be redundant, i.e., they are also found to be important in the <em>intraview</em>. To focus on the interactions coming from the <em>paraview</em> only we can plot the contrast between these results.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">misty.results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_contrast_heatmap.html">plot_contrast_heatmap</a></span><span class="op">(</span><span class="st">"intra"</span>, <span class="st">"para.10"</span>, cutoff <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="mistyR_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>Futhermore, since the predictor and target markers in both views are the same, we can plot the interaction communities that can be extracted from the estimated interaction pairs from the <em>intraview</em></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">misty.results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_interaction_communities.html">plot_interaction_communities</a></span><span class="op">(</span><span class="st">"intra"</span><span class="op">)</span></code></pre></div>
<p><img src="mistyR_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>and the <em>paraview</em>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">misty.results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_interaction_communities.html">plot_interaction_communities</a></span><span class="op">(</span><span class="st">"para.10"</span>, cutoff <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="mistyR_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>When interpreting the results and the plots it is important to note that the relationships captured in the importances are not to assumed or interpreted as linear or casual. Furthermore, the estimated importance of a single predictor - marker pair should not be interpredes in isolation but in the context of the other predictors, since training MISTy models is multivariate predictive task.</p>
<hr>
</div>
<div class="section level2">
<h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<div class="section level3">
<h3 id="more-examples">More examples<a class="anchor" aria-label="anchor" href="#more-examples"></a>
</h3>
<p><code>browseVignettes("mistyR")</code></p>
<p><a href="https://saezlab.github.io/mistyR/articles/">Online articles</a></p>
</div>
<div class="section level3">
<h3 id="publication">Publication<a class="anchor" aria-label="anchor" href="#publication"></a>
</h3>
<p><em>Jovan Tanevski, Ricardo Omar Ramirez Flores, Attila Gabor, Denis Schapiro, Julio Saez-Rodriguez. Explainable multiview framework for dissecting spatial relationships from highly multiplexed data. Genome Biology 23, 97 (2022). <a href="https://doi.org/10.1186/s13059-022-02663-5" class="external-link uri">https://doi.org/10.1186/s13059-022-02663-5</a></em></p>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<p>Here is the output of <code><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo()</a></code> at the point when this document was compiled:</p>
<pre><code><span class="co">#&gt; R version 4.2.0 (2022-04-22)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Ubuntu 20.04.4 LTS</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0</span>
<span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random number generation:</span>
<span class="co">#&gt;  RNG:     L'Ecuyer-CMRG </span>
<span class="co">#&gt;  Normal:  Inversion </span>
<span class="co">#&gt;  Sample:  Rejection </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span>
<span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span>
<span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span>
<span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] ggplot2_3.3.6    distances_0.1.8  purrr_0.3.4      dplyr_1.0.9     </span>
<span class="co">#&gt; [5] future_1.25.0    mistyR_1.4.0     BiocStyle_2.24.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] tidyr_1.2.0         listenv_0.8.0       assertthat_0.2.1   </span>
<span class="co">#&gt;  [4] rprojroot_2.0.3     digest_0.6.29       utf8_1.2.2         </span>
<span class="co">#&gt;  [7] parallelly_1.31.1   R6_2.5.1            evaluate_0.15      </span>
<span class="co">#&gt; [10] highr_0.9           pillar_1.7.0        rlang_1.0.2        </span>
<span class="co">#&gt; [13] data.table_1.14.2   furrr_0.3.0         jquerylib_0.1.4    </span>
<span class="co">#&gt; [16] R.oo_1.24.0         R.utils_2.11.0      rmarkdown_2.14     </span>
<span class="co">#&gt; [19] pkgdown_2.0.3       textshaping_0.3.6   desc_1.4.1         </span>
<span class="co">#&gt; [22] labeling_0.4.2      stringr_1.4.0       igraph_1.3.1       </span>
<span class="co">#&gt; [25] munsell_0.5.0       compiler_4.2.0      xfun_0.30          </span>
<span class="co">#&gt; [28] pkgconfig_2.0.3     systemfonts_1.0.4   globals_0.14.0     </span>
<span class="co">#&gt; [31] htmltools_0.5.2     tidyselect_1.1.2    tibble_3.1.7       </span>
<span class="co">#&gt; [34] bookdown_0.26       codetools_0.2-18    fansi_1.0.3        </span>
<span class="co">#&gt; [37] crayon_1.5.1        withr_2.5.0         R.methodsS3_1.8.1  </span>
<span class="co">#&gt; [40] grid_4.2.0          jsonlite_1.8.0      gtable_0.3.0       </span>
<span class="co">#&gt; [43] lifecycle_1.0.1     DBI_1.1.2           magrittr_2.0.3     </span>
<span class="co">#&gt; [46] scales_1.2.0        rlist_0.4.6.2       cli_3.3.0          </span>
<span class="co">#&gt; [49] stringi_1.7.6       cachem_1.0.6        farver_2.1.0       </span>
<span class="co">#&gt; [52] fs_1.5.2            bslib_0.3.1         filelock_1.0.2     </span>
<span class="co">#&gt; [55] ellipsis_0.3.2      ragg_1.2.2          generics_0.1.2     </span>
<span class="co">#&gt; [58] vctrs_0.4.1         RColorBrewer_1.1-3  tools_4.2.0        </span>
<span class="co">#&gt; [61] glue_1.6.2          parallel_4.2.0      fastmap_1.1.0      </span>
<span class="co">#&gt; [64] yaml_2.3.5          colorspace_2.0-3    BiocManager_1.30.17</span>
<span class="co">#&gt; [67] memoise_2.0.1       knitr_1.39          sass_0.4.1</span></code></pre>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>You will notice that <code>misty.intra</code> contains an element named <code>misty.uniqueid</code> that is used for caching. If not provided, this id is automatically generated.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><em>juxtaview</em> and <em>paraview</em> calculated and added by <code><a href="../reference/add_juxtaview.html">add_juxtaview()</a></code> and <code><a href="../reference/add_paraview.html">add_paraview()</a></code> respectively<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jovan Tanevski.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
