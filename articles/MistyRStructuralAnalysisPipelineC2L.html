<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mistyR">
<title>Structural analysis with MISTy - based on cell2location deconvolution • mistyR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Structural analysis with MISTy - based on cell2location deconvolution">
<meta property="og:description" content="mistyR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119440867-9"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-119440867-9');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mistyR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.10.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/mistyR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/FunctionalAndStructuralPipeline.html">Learning functional and structural spatial relationships with MISTy</a>
    <a class="dropdown-item" href="../articles/FunctionalPipelinePathwayActivityLigands.html">Functional analysis with MISTy - pathway activity and ligand expression</a>
    <a class="dropdown-item" href="../articles/FunctionalPipelinePathwaySpecific.html">Functional analysis with MISTy - pathway specific genes</a>
    <a class="dropdown-item" href="../articles/MistyRStructuralAnalysisPipelineC2L.html">Structural analysis with MISTy - based on cell2location deconvolution</a>
    <a class="dropdown-item" href="../articles/MistyRStructuralAnalysisPipelineDOT.html">Structural analysis with MISTy - based on DOT deconvolution</a>
    <a class="dropdown-item" href="../articles/ReproduceSignaturePaper.html">MISTy representation based analysis of IMC breast cancer data</a>
    <a class="dropdown-item" href="../articles/mistyDataFormats.html">mistyR and data formats</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/saezlab/mistyR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/saezlab">
    <span class="fab fa fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://saezlab.org/">
    <span class="fas fa fas fa-university"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Structural analysis with MISTy - based on cell2location deconvolution</h1>
                        <h4 data-toc-skip class="author">Leoni
Zimmermann</h4>
            <address class="author_afil">
      Heidelberg University, Heidelberg,
Germany<br><h4 data-toc-skip class="author">Jovan
Tanevski</h4>
            <address class="author_afil">
      Heidelberg University and Heidelberg University Hospital,
Heidelberg, Germany <br>Jožef Stefan Institute, Ljubljana,
Slovenia<br><a class="author_email" href="mailto:#"></a><a href="mailto:jovan.tanevski@uni-heidelberg.de" class="email">jovan.tanevski@uni-heidelberg.de</a>
      </address>
                  
            <h4 data-toc-skip class="date">2024-03-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/saezlab/mistyR/blob/HEAD/vignettes/MistyRStructuralAnalysisPipelineC2L.Rmd" class="external-link"><code>vignettes/MistyRStructuralAnalysisPipelineC2L.Rmd</code></a></small>
      <div class="d-none name"><code>MistyRStructuralAnalysisPipelineC2L.Rmd</code></div>
    </address>
</div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>MISTy is designed to analyze spatial omics datasets within and
between distinct spatial contexts referred to as views. This analysis
can focus solely on structural information. Spatial transcriptomic
methods such as 10x Visium capture information from areas containing
multiple cells. Then, deconvolution is applied to relate the measured
data of the spots back to individual cells. A commonly used tool for
this deconvolution step is cell2location.</p>
<p>This vignette presents a workflow for the analysis of structural
data, guiding users through the application of <code>mistyR</code> to
the results of <code>cell2location</code> deconvolution.</p>
<p>Load the necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># MISTy </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://saezlab.github.io/mistyR/">mistyR</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#Seurat </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mojaveazure.github.io/seurat-object/" class="external-link">SeuratObject</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data manipulation </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Distances</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fsavje/distances" class="external-link">distances</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-and-load-the-data">Get and load the data<a class="anchor" aria-label="anchor" href="#get-and-load-the-data"></a>
</h2>
<p>For this showcase, we use a 10X Visium spatial slide from <a href="https://doi.org/10.1038/s41586-022-05060-x" class="external-link">Kuppe et al.,
2022</a>, where they created a spatial multi-omic map of human
myocardial infarction. The example data comes from a human heart in a
later state after myocardial infarction that was used in the study. The
Seurat object contains, among other things, the coordinates of the spots
on the slides and their cellular composition estimated by cell2location.
First, we have to download and extract the file:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://zenodo.org/records/6580069/files/10X_Visium_ACH005.tar.gz?download=1"</span>,</span>
<span>    destfile <span class="op">=</span> <span class="st">"10X_Visium_ACH005.tar.gz"</span>, method <span class="op">=</span> <span class="st">"curl"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/untar.html" class="external-link">untar</a></span><span class="op">(</span><span class="st">"10X_Visium_ACH005.tar.gz"</span><span class="op">)</span></span></code></pre></div>
<p>The next step is to load the data and extract the cell composition
and location of the spots. The rows are shifted, which means that the
real distances between two spots are not always the same. It is
therefore advantageous to use the pixel coordinates instead of row and
column numbers, as the distances between these are represented
accurately.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load file into R</span></span>
<span><span class="va">seurat_vs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"ACH005/ACH005.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the cell composition</span></span>
<span><span class="va">composition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">seurat_vs</span><span class="op">[[</span><span class="st">"c2l_props"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Extract the location data</span></span>
<span><span class="va">geometry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/GetTissueCoordinates.html" class="external-link">GetTissueCoordinates</a></span><span class="op">(</span><span class="va">seurat_vs</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"imagerow"</span>, <span class="st">"imagecol"</span><span class="op">)</span>, scale <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualize-cell-proportion-in-spots">Visualize cell proportion in spots<a class="anchor" aria-label="anchor" href="#visualize-cell-proportion-in-spots"></a>
</h2>
<p>First, we visually explore the slide itself and then through a
graphical representation of cell-type proportions at each spot. When
adding <code>interactive = TRUE</code> to
<code>SpatialFeaturePlot</code> we can cycle through the proportions of
the different celltypes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tissue Slide</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/SpatialPlot.html" class="external-link">SpatialPlot</a></span><span class="op">(</span><span class="va">seurat_vs</span>, keep.scale <span class="op">=</span> <span class="cn">NULL</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </span></code></pre></div>
<p><img src="MistyRStructuralAnalysisPipelineC2L_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cell type proportions</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/DefaultAssay.html" class="external-link">DefaultAssay</a></span><span class="op">(</span><span class="va">seurat_vs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"c2l_props"</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/SpatialPlot.html" class="external-link">SpatialFeaturePlot</a></span><span class="op">(</span><span class="va">seurat_vs</span>, keep.scale <span class="op">=</span> <span class="cn">NULL</span>, features <span class="op">=</span> <span class="st">"CM"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="MistyRStructuralAnalysisPipelineC2L_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>Based on the plots, we can observe that some cell types are found
more frequently than others. Additionally, we can identify patterns in
the distribution of cells, with some being widespread across the entire
slide while others are concentrated in specific areas. Furthermore,
there are cell types that share a similar distribution.</p>
</div>
<div class="section level2">
<h2 id="misty-views">MISTy views<a class="anchor" aria-label="anchor" href="#misty-views"></a>
</h2>
<p>First, we need to define an intraview that captures the cell type
proportions within a spot. To capture the distribution of cell type
proportions in the surrounding tissue, we add a paraview. For this
vignette, the radius we choose is the distance to the nearest neighbor
plus the standard deviation. We calculate the weights of each spot with
<code>family = gaussian</code>. Then we run MISTy and collect the
results.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculating the radius</span></span>
<span><span class="va">geom_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/distances/man/distances.html" class="external-link">distances</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span>  </span>
<span><span class="va">dist_nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">geom_dist</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">paraview_radius</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dist_nn</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">dist_nn</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create views</span></span>
<span><span class="va">heart_views</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_initial_view.html">create_initial_view</a></span><span class="op">(</span><span class="va">composition</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_paraview.html">add_paraview</a></span><span class="op">(</span><span class="va">geometry</span>, l<span class="op">=</span> <span class="va">paraview_radius</span>, family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run misty and collect results</span></span>
<span><span class="fu"><a href="../reference/run_misty.html">run_misty</a></span><span class="op">(</span><span class="va">heart_views</span>, <span class="st">"result/vignette_structural_pipeline"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/home/runner/work/mistyR/mistyR/vignettes/result/vignette_structural_pipeline"</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">misty_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collect_results.html">collect_results</a></span><span class="op">(</span><span class="st">"result/vignette_structural_pipeline"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="downstream-analysis">Downstream Analysis<a class="anchor" aria-label="anchor" href="#downstream-analysis"></a>
</h2>
<p>With the collected results, we can now answer following
questions:</p>
<div class="section level4">
<h4 id="to-what-extent-can-the-occurring-cell-types-of-the-surrounding-tissue-explain-the-cell-type-composition-of-the-spot-compared-to-the-intraview">1. To what extent can the occurring cell types of the surrounding
tissue explain the cell type composition of the spot compared to the
intraview?<a class="anchor" aria-label="anchor" href="#to-what-extent-can-the-occurring-cell-types-of-the-surrounding-tissue-explain-the-cell-type-composition-of-the-spot-compared-to-the-intraview"></a>
</h4>
<p>Here we can look at two different statistics: <code>multi.R2</code>
shows the total variance explained by the multiview model.
<code>gain.R2</code> shows the increase in explainable variance from to
the paraview.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">misty_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/plot_improvement_stats.html">plot_improvement_stats</a></span><span class="op">(</span><span class="st">"multi.R2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plot_improvement_stats.html">plot_improvement_stats</a></span><span class="op">(</span><span class="st">"gain.R2"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 11 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_segment()`).</span></span></code></pre>
<p><img src="MistyRStructuralAnalysisPipelineC2L_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<pre><code><span><span class="co">## Warning: Removed 11 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_segment()`).</span></span></code></pre>
<p><img src="MistyRStructuralAnalysisPipelineC2L_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>The paraview particularly increases the explained variance for
adipocytes and mast cells. In general, the significant gain in
R<sup>2</sup> can be interpreted as the following:</p>
<p>“We can better explain the expression of marker X when we consider
additional views other than the intrinsic view.”</p>
</div>
<div class="section level4">
<h4 id="what-are-the-specific-relations-that-can-explain-the-contributions">2. What are the specific relations that can explain the
contributions?<a class="anchor" aria-label="anchor" href="#what-are-the-specific-relations-that-can-explain-the-contributions"></a>
</h4>
<p>To explain the contributions, we can visualize the importance of each
cell type in predicting the cell type distribution for each view
separately.</p>
<p>First, for the intrinsic view:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">misty_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_interaction_heatmap.html">plot_interaction_heatmap</a></span><span class="op">(</span>view <span class="op">=</span> <span class="st">"intra"</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="MistyRStructuralAnalysisPipelineC2L_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>We can observe that cardiomyocytes are a significant predictor for
several cell types when in the same spot. To identify the target with
the best prediction by cardiomyocytes, we can view the importance values
as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">misty_results</span><span class="op">$</span><span class="va">importances.aggregated</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">view</span> <span class="op">==</span> <span class="st">"intra"</span>, <span class="va">Predictor</span> <span class="op">==</span> <span class="st">"CM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">Importance</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 11 × 5</span></span></span>
<span><span class="co">##    view  Predictor Target   Importance nsamples</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> intra CM        Fib          2.74          1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> intra CM        vSMCs        2.43          1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> intra CM        prolif       2.23          1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> intra CM        Myeloid      2.21          1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> intra CM        Endo         2.15          1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> intra CM        Mast         2.02          1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> intra CM        PC           1.90          1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> intra CM        Lymphoid     0.844         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> intra CM        Adipo       -<span style="color: #BB0000;">0.041</span><span style="color: #BB0000; text-decoration: underline;">6</span>        1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> intra CM        Neuronal    -<span style="color: #BB0000;">0.086</span><span style="color: #BB0000; text-decoration: underline;">5</span>        1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> intra CM        CM          <span style="color: #BB0000;">NA</span>             1</span></span></code></pre>
<p>Let’s take a look at the spatial distribution of these cell types in
the tissue slide:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/SpatialPlot.html" class="external-link">SpatialFeaturePlot</a></span><span class="op">(</span><span class="va">seurat_vs</span>, keep.scale <span class="op">=</span> <span class="cn">NULL</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fib"</span>,<span class="st">"CM"</span><span class="op">)</span>, image.alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="MistyRStructuralAnalysisPipelineC2L_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>We can observe that areas with high proportions of cardiomyocytes
have low proportions of fibroblasts and vice versa.</p>
<p>Now we repeat this analysis with the paraview. With <code>trim</code>
we display only targets with a value above 1.75 for
<code>gain.R2</code>. To set an importance threshold we apply
<code>cutoff</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">misty_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/plot_interaction_heatmap.html">plot_interaction_heatmap</a></span><span class="op">(</span>view <span class="op">=</span> <span class="st">"para.126"</span>, clean <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                           trim <span class="op">=</span> <span class="fl">1.75</span>, trim.measure <span class="op">=</span> <span class="st">"gain.R2"</span>,</span>
<span>                                           cutoff <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> </span></code></pre></div>
<p><img src="MistyRStructuralAnalysisPipelineC2L_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Here, we select the target adipocytes, as we know from previous
analysis that the paraview contributes a large part to explaining its
distribution. The best predictor for adipocytes are proliferating
cells:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/SpatialPlot.html" class="external-link">SpatialFeaturePlot</a></span><span class="op">(</span><span class="va">seurat_vs</span>, keep.scale <span class="op">=</span> <span class="cn">NULL</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prolif"</span>,<span class="st">"Adipo"</span><span class="op">)</span>, image.alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="MistyRStructuralAnalysisPipelineC2L_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>The plots show us that, in some places, the localization of the two
cell types overlap.</p>
</div>
</div>
<div class="section level2">
<h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<p><code>browseVignettes("mistyR")</code></p>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<p>Here is the output of <code><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo()</a></code> at the point when
this document was compiled.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.3 (2024-02-29)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] distances_0.1.10   lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1     </span></span>
<span><span class="co">##  [5] dplyr_1.1.4        purrr_1.0.2        readr_2.1.5        tidyr_1.3.1       </span></span>
<span><span class="co">##  [9] tibble_3.2.1       ggplot2_3.5.0      tidyverse_2.0.0    Seurat_5.0.2      </span></span>
<span><span class="co">## [13] SeuratObject_5.0.1 sp_2.1-3           future_1.33.1      mistyR_1.10.0     </span></span>
<span><span class="co">## [17] BiocStyle_2.30.0  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] RcppAnnoy_0.0.22       splines_4.3.3          later_1.3.2           </span></span>
<span><span class="co">##   [4] filelock_1.0.3         R.oo_1.26.0            polyclip_1.10-6       </span></span>
<span><span class="co">##   [7] hardhat_1.3.1          pROC_1.18.5            rpart_4.1.23          </span></span>
<span><span class="co">##  [10] fastDummies_1.7.3      lifecycle_1.0.4        vroom_1.6.5           </span></span>
<span><span class="co">##  [13] globals_0.16.2         lattice_0.22-5         MASS_7.3-60.0.1       </span></span>
<span><span class="co">##  [16] magrittr_2.0.3         plotly_4.10.4          sass_0.4.8            </span></span>
<span><span class="co">##  [19] rmarkdown_2.26         jquerylib_0.1.4        yaml_2.3.8            </span></span>
<span><span class="co">##  [22] rlist_0.4.6.2          httpuv_1.6.14          sctransform_0.4.1     </span></span>
<span><span class="co">##  [25] spam_2.10-0            spatstat.sparse_3.0-3  reticulate_1.35.0     </span></span>
<span><span class="co">##  [28] cowplot_1.1.3          pbapply_1.7-2          RColorBrewer_1.1-3    </span></span>
<span><span class="co">##  [31] abind_1.4-5            Rtsne_0.17             R.utils_2.12.3        </span></span>
<span><span class="co">##  [34] nnet_7.3-19            ipred_0.9-14           lava_1.8.0            </span></span>
<span><span class="co">##  [37] ggrepel_0.9.5          irlba_2.3.5.1          listenv_0.9.1         </span></span>
<span><span class="co">##  [40] spatstat.utils_3.0-4   goftest_1.2-3          RSpectra_0.16-1       </span></span>
<span><span class="co">##  [43] spatstat.random_3.2-3  fitdistrplus_1.1-11    parallelly_1.37.1     </span></span>
<span><span class="co">##  [46] pkgdown_2.0.7          leiden_0.4.3.1         codetools_0.2-19      </span></span>
<span><span class="co">##  [49] tidyselect_1.2.0       farver_2.1.1           stats4_4.3.3          </span></span>
<span><span class="co">##  [52] matrixStats_1.2.0      spatstat.explore_3.2-6 jsonlite_1.8.8        </span></span>
<span><span class="co">##  [55] caret_6.0-94           ellipsis_0.3.2         progressr_0.14.0      </span></span>
<span><span class="co">##  [58] ggridges_0.5.6         survival_3.5-8         iterators_1.0.14      </span></span>
<span><span class="co">##  [61] systemfonts_1.0.6      foreach_1.5.2          tools_4.3.3           </span></span>
<span><span class="co">##  [64] ragg_1.2.7             ica_1.0-3              Rcpp_1.0.12           </span></span>
<span><span class="co">##  [67] glue_1.7.0             prodlim_2023.08.28     gridExtra_2.3         </span></span>
<span><span class="co">##  [70] xfun_0.42              ranger_0.16.0          withr_3.0.0           </span></span>
<span><span class="co">##  [73] BiocManager_1.30.22    fastmap_1.1.1          fansi_1.0.6           </span></span>
<span><span class="co">##  [76] digest_0.6.34          timechange_0.3.0       R6_2.5.1              </span></span>
<span><span class="co">##  [79] mime_0.12              textshaping_0.3.7      colorspace_2.1-0      </span></span>
<span><span class="co">##  [82] scattermore_1.2        tensor_1.5             spatstat.data_3.0-4   </span></span>
<span><span class="co">##  [85] R.methodsS3_1.8.2      utf8_1.2.4             generics_0.1.3        </span></span>
<span><span class="co">##  [88] data.table_1.15.2      recipes_1.0.10         class_7.3-22          </span></span>
<span><span class="co">##  [91] httr_1.4.7             ridge_3.3              htmlwidgets_1.6.4     </span></span>
<span><span class="co">##  [94] ModelMetrics_1.2.2.2   uwot_0.1.16            pkgconfig_2.0.3       </span></span>
<span><span class="co">##  [97] gtable_0.3.4           timeDate_4032.109      lmtest_0.9-40         </span></span>
<span><span class="co">## [100] furrr_0.3.1            htmltools_0.5.7        dotCall64_1.1-1       </span></span>
<span><span class="co">## [103] bookdown_0.38          scales_1.3.0           png_0.1-8             </span></span>
<span><span class="co">## [106] gower_1.0.1            knitr_1.45             tzdb_0.4.0            </span></span>
<span><span class="co">## [109] reshape2_1.4.4         nlme_3.1-164           cachem_1.0.8          </span></span>
<span><span class="co">## [112] zoo_1.8-12             KernSmooth_2.23-22     parallel_4.3.3        </span></span>
<span><span class="co">## [115] miniUI_0.1.1.1         desc_1.4.3             pillar_1.9.0          </span></span>
<span><span class="co">## [118] grid_4.3.3             vctrs_0.6.5            RANN_2.6.1            </span></span>
<span><span class="co">## [121] promises_1.2.1         xtable_1.8-4           cluster_2.1.6         </span></span>
<span><span class="co">## [124] evaluate_0.23          cli_3.6.2              compiler_4.3.3        </span></span>
<span><span class="co">## [127] crayon_1.5.2           rlang_1.1.3            future.apply_1.11.1   </span></span>
<span><span class="co">## [130] labeling_0.4.3         plyr_1.8.9             fs_1.6.3              </span></span>
<span><span class="co">## [133] stringi_1.8.3          viridisLite_0.4.2      deldir_2.0-4          </span></span>
<span><span class="co">## [136] assertthat_0.2.1       munsell_0.5.0          lazyeval_0.2.2        </span></span>
<span><span class="co">## [139] spatstat.geom_3.2-9    Matrix_1.6-5           RcppHNSW_0.6.0        </span></span>
<span><span class="co">## [142] hms_1.1.3              patchwork_1.2.0        bit64_4.0.5           </span></span>
<span><span class="co">## [145] shiny_1.8.0            highr_0.10             ROCR_1.0-11           </span></span>
<span><span class="co">## [148] igraph_2.0.2           memoise_2.0.1          bslib_0.6.1           </span></span>
<span><span class="co">## [151] bit_4.0.5</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jovan Tanevski.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
